<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MY CRM</title>

  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="./css/trackerpage.css">
</head>
<body data-role="admin">

<div class="app-layout" id="appLayout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-header">
        <button id="menu-toggle" class="hamburger" title="Expand menu">â˜°</button>
        <h2 class="logo">ADMIN</h2>
    </div>
    
    <button class="nav-btn active" data-target="dashboard">Dashboard</button>
    <button class="nav-btn" data-target="users">Users</button>
    <button class="nav-btn" data-target="trackers">Trackers</button>
    <button class="nav-btn" data-target="logs">Logs</button>
    <button class="nav-btn" data-target="analytics">Analytics</button>
    <button class="nav-btn" data-target="appointments">Appointments</button>

    <div class="sidebar-footer">
        <button id="logoutBtn" class="btn-logout" title="Log out">
            <svg class="logout-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M7.707,8.707,5.414,11H17a1,1,0,0,1,0,2H5.414l2.293,2.293a1,1,0,1,1-1.414,1.414l-4-4a1,1,0,0,1,0-1.414l4-4A1,1,0,1,1,7.707,8.707ZM21,1H13a1,1,0,0,0,0,2h7V21H13a1,1,0,0,0,0,2h8a1,1,0,0,0,1-1V2A1,1,0,0,0,21,1Z"></path>
            </svg>
        </button>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">

    <header id="dashboardHeader">Welcome, Admin</header>
      
    <!-- DASHBOARD -->
    <section class="page active" data-page="dashboard">
      <h1>Dashboard</h1>
      <p>Welcome to your dashboard</p>
      <div class="stats-container">
        <p>Total Users: <span id="totalUsers">0</span></p>
        <p>Total Trackers: <span id="totalTrackers">0</span></p>
        <p>Today's Submissions: <span id="todaySubmissions">0</span></p>
        <p>Average Bad Lead %: <span id="avgBadLead">0%</span></p>
      </div>
    </section>

    <!-- USERS -->
    <section class="page" data-page="users">
      <h1>Users</h1>
      <div id="usersContent">Loading...</div>
    </section>

    <!-- TRACKERS -->
    <section class="page" data-page="trackers">
      <h1>Trackers</h1>

      <div id="loadingTrackers" style="display:none;">Loading Trackers...</div>

      <!-- BUTTON TO ADD MANAGER CARD -->
      <button id="addBtn" class="secondary-btn" onclick="toggleModal()">+</button>
      <hr>

      <!-- TRACKER TEMPLATE HEADER (TOP FIELDS) -->
      <div class="sheet-header" style="margin-bottom: 20px;">
        <h2>Tracker Template</h2>

        <label>Shift:
          <select id="shiftSelect">
            <option>Morning</option>
            <option>Evening</option>
          </select>
        </label>

        <label>Date:
          <input type="date" id="trackerDate">
        </label>

        <label>Hours:
          <input type="number" id="trackerHours" step="0.25">
        </label>

        <label>Additional Appointments:
          <input type="text" id="additionalAppointments">
        </label>

        <button id="addRowBtn">+ Add Row</button>
        <button id="submitAllBtn">Submit Tracker</button>
      </div>

      <!-- TRACKER ROWS -->
      <div id="trackerList" style="margin-top: 20px;"></div>

      <!-- ADD TRACKER MODAL -->
      <div id="trackerModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px; width: 90%;">
          <h3>Add New Manager</h3>
          <p style="font-size: 0.9em; color: #666;">This will send a new manager card to all active users.</p>  

          <form onsubmit="handlePublish(event); return false;">
            <div style="margin-bottom: 20px;">
              <label for="trackerInput" style="display: block; margin-bottom: 5px; font-weight: bold;">Manager Name:</label>
              <input type="text" id="trackerInput" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" placeholder="e.g. Sales Team Alpha" required>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
              <button type="button" onclick="toggleModal()" style="padding: 10px 20px; background: #ddd; border: none; border-radius: 4px; cursor: pointer;">
                Cancel
              </button>
              <button type="submit" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                Push to Users
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>


    <!-- LOGS -->
    <section class="page" data-page="logs">
      <h1>Logs</h1>

      <table class="sheet">
        <thead>
          <tr>
            <th>#</th>
            <th>Phone</th>
            <th>Status</th>
            <th>Comments</th>
          </tr>
        </thead>
        <tbody id="sheetBody">
          <tr>
            <td>1</td>
            <td contenteditable="true">09123456789</td>
            <td contenteditable="true">No Answer</td>
            <td contenteditable="true"></td>
          </tr>
        </tbody>
      </table>

    </section>

    <!-- ANALYTICS -->
    <section class="page" data-page="analytics">
    <h1>Analytics</h1>
    <div class="stats-container">
        <p>Total Submissions: <span id="totalSubmissions">0</span></p>
        <p>Today's Submissions: <span id="todaySubmissionsMetric">0</span></p>
        <p>Average Bad Lead %: <span id="avgBadLeadMetric">0%</span></p>
    </div>
    </section>

  </main>
</div>

<script src="/socket.io/socket.io.js"></script>
<script type="module" src="/js/socket.js"></script>
<script type="module" src="/js/modules/admin/admin.js"></script>


</body>
</html>
